---
title: Arepo
description: Conda-based beginner guide to compile and run the AREPO wave_1d example.
sidebar:
  order: 1
---

import { Aside, TabItem, Tabs } from '@astrojs/starlight/components';

This page is designed so a first-time user can **create a `conda` environment and run one AREPO example end-to-end**.

## Target outcome

You are done when all 3 are true:

1. `conda` environment `arepo-lab` is created and activated
2. `wave_1d` is compiled and executed
3. `check.py` passes (exit code 0)

## Quick snapshot

- **Method family**: Moving-mesh finite-volume hydrodynamics
- **Core traits**: Voronoi moving mesh + gravity + (with modules) MHD/RT
- **Typical usage**: Illustris, IllustrisTNG, Auriga, MillenniumTNG-style work
- **Beginner strategy**: Keep a fixed validation loop (`create -> run -> check`)

## Installation

<Tabs syncKey="arepo-conda-install-os">
  <TabItem label="Windows (WSL2)">
    #### 0) Install WSL2 + Ubuntu (PowerShell as Administrator)

    ```powershell
    wsl --install -d Ubuntu
    ```

    If WSL is already installed, you can skip this step.
    Reboot if prompted, open the **Ubuntu** app, then continue below.

    #### 1) Install Conda inside Ubuntu (WSL)

    ```bash
    sudo apt update
    sudo apt install -y curl bzip2

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init bash
    ```

    Re-open the Ubuntu terminal before continuing.
  </TabItem>

  <TabItem label="macOS">
    #### 0) Install Conda

    ```bash
    xcode-select --install

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init zsh
    ```

    Re-open the terminal before continuing.
  </TabItem>

  <TabItem label="Linux (Ubuntu)">
    #### 0) Install Conda

    ```bash
    sudo apt update
    sudo apt install -y curl bzip2

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init bash
    ```

    Re-open the terminal before continuing.
  </TabItem>
</Tabs>

### 1) Create `arepo-lab` environment

```bash
conda create -n arepo-lab -c conda-forge \
  python=3.11 numpy h5py mpi4py openmpi gsl fftw hdf5 hwloc compilers make perl git -y

conda activate arepo-lab

which python
which mpicc
echo "$CONDA_PREFIX"
```

<Aside type="tip" title="Rule of thumb">
Run every command on this page only after `conda activate arepo-lab`.
</Aside>

### 2) Prepare AREPO source

```bash
cd ~
git clone https://gitlab.mpcdf.mpg.de/vrs/arepo.git
cd arepo
```

<Aside type="note" title="Source access permission">
If cloning fails due to permissions, obtain AREPO through the official release channel first,
then continue from your extracted `arepo` root directory.
</Aside>

### 3) Prepare `wave_1d`

```bash
mkdir -p run/examples/wave_1d
cp -r examples/wave_1d/* run/examples/wave_1d/
python run/examples/wave_1d/create.py run/examples/wave_1d/
```

### 4) Compile against Conda libraries

```bash
export LD_LIBRARY_PATH="$CONDA_PREFIX/lib:${LD_LIBRARY_PATH:-}"
export DYLD_FALLBACK_LIBRARY_PATH="$CONDA_PREFIX/lib:${DYLD_FALLBACK_LIBRARY_PATH:-}"

make -j"$(getconf _NPROCESSORS_ONLN 2>/dev/null || sysctl -n hw.ncpu)" \
  SYSTYPE=Conda \
  CC=mpicc LINKER=mpicc \
  MPICH_INCL="-I${CONDA_PREFIX}/include" \
  MPICH_LIB="-L${CONDA_PREFIX}/lib -lmpi" \
  GSL_INCL="-I${CONDA_PREFIX}/include" \
  GSL_LIB="-L${CONDA_PREFIX}/lib -lgsl -lgslcblas" \
  HDF5_INCL="-I${CONDA_PREFIX}/include -DH5_USE_16_API" \
  HDF5_LIB="-L${CONDA_PREFIX}/lib -lhdf5 -lz" \
  FFTW_INCL="-I${CONDA_PREFIX}/include" \
  FFTW_LIBS="-L${CONDA_PREFIX}/lib" \
  HWLOC_INCL="-I${CONDA_PREFIX}/include" \
  HWLOC_LIB="-L${CONDA_PREFIX}/lib -lhwloc" \
  CONFIG=run/examples/wave_1d/Config.sh \
  BUILD_DIR=run/examples/wave_1d/build \
  EXEC=run/examples/wave_1d/Arepo
```

### 5) Run + verify

```bash
(cd run/examples/wave_1d && mpiexec -np 1 ./Arepo ./param.txt)
python run/examples/wave_1d/check.py run/examples/wave_1d/ False
```

Success criteria:
- `check.py` exits normally with code `0`
- L1 error lines are printed, but remain within tolerance

### 6) Common failures

- `CondaError: Run 'conda init' before 'conda activate'`
  - Run `conda init bash` or `conda init zsh`, then start a new terminal.
- `fatal error: mpi.h: No such file or directory`
  - Confirm environment is active and `which mpicc` points inside the env.
- `cannot find -lhdf5` / `cannot find -lgsl`
  - Confirm `${CONDA_PREFIX}/lib` is present in `HDF5_LIB` / `GSL_LIB`.
- Runtime shared-lib errors (`libmpi`, `libhdf5`)
  - Re-export `LD_LIBRARY_PATH` (Linux/WSL) or `DYLD_FALLBACK_LIBRARY_PATH` (macOS).

## Official references

- [AREPO User Guide: Getting started](https://arepo-code.org/wp-content/userguide/running.html)
- [AREPO User Guide: Simulation examples](https://arepo-code.org/wp-content/userguide/simtypes.html)
- [AREPO public repository (GitLab)](https://gitlab.mpcdf.mpg.de/vrs/arepo)

## Continue

- [Compare table](/en/compare/)
- [Glossary](/en/glossary/)
