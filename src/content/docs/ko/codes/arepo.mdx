---
title: Arepo
description: Conda 가상환경 기반으로 AREPO 예제(wave_1d)를 직접 실행하는 입문 가이드.
sidebar:
  order: 1
---

import { Aside, TabItem, Tabs } from '@astrojs/starlight/components';

이 페이지의 목표는 **처음 접하는 사용자도 `conda` 가상환경에서 AREPO 예제 1개를 끝까지 실행**하는 것입니다.

## 실행 목표

아래 3가지를 완료하면 성공입니다.

1. `conda` 환경 `arepo-lab` 생성/활성화
2. `wave_1d` 예제 컴파일 및 실행
3. `check.py` 검증 통과(에러 코드 0)

## 빠른 스냅샷

- **방법 계열**: moving-mesh 유한체적 계열
- **핵심 특성**: Voronoi moving mesh + 중력 + (확장 시) MHD/RT
- **대표 사용처**: Illustris, IllustrisTNG, Auriga, MillenniumTNG 계열 연구
- **입문 전략**: 작은 1D 예제부터 검증 루프(`create -> run -> check`)를 고정

## Installation

<Tabs syncKey="arepo-conda-install-os">
  <TabItem label="Windows (WSL2)">
    #### 0) WSL2 + Ubuntu 설치 (PowerShell 관리자 권한)

    ```powershell
    wsl --install -d Ubuntu
    ```

    이미 설치되어 있다면 이 단계는 건너뛰셔도 됩니다.
    설치 후 재부팅 안내가 나오면 재부팅하고, **Ubuntu 앱**을 연 뒤 아래를 진행하세요.

    #### 1) Ubuntu(WSL)에서 Conda 설치

    ```bash
    sudo apt update
    sudo apt install -y curl bzip2

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init bash
    ```

    Ubuntu 터미널을 다시 열고 계속 진행하세요.
  </TabItem>

  <TabItem label="macOS">
    #### 0) Conda 설치

    ```bash
    xcode-select --install

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init zsh
    ```

    터미널을 다시 열고 계속 진행하세요.
  </TabItem>

  <TabItem label="Linux (Ubuntu)">
    #### 0) Conda 설치

    ```bash
    sudo apt update
    sudo apt install -y curl bzip2

    curl -L -o ~/miniforge.sh \
      https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-$(uname -m).sh
    bash ~/miniforge.sh -b -p "$HOME/miniforge3"

    source "$HOME/miniforge3/etc/profile.d/conda.sh"
    conda init bash
    ```

    터미널을 다시 열고 계속 진행하세요.
  </TabItem>
</Tabs>

### 1) `arepo-lab` 가상환경 생성

```bash
conda create -n arepo-lab -c conda-forge \
  python=3.11 numpy h5py mpi4py openmpi gsl fftw hdf5 hwloc compilers make perl git -y

conda activate arepo-lab

which python
which mpicc
echo "$CONDA_PREFIX"
```

<Aside type="tip" title="중요 원칙">
이 페이지의 모든 명령은 반드시 `conda activate arepo-lab` 이후에 실행하세요.
</Aside>

### 2) AREPO 소스 준비

```bash
cd ~
git clone https://gitlab.mpcdf.mpg.de/vrs/arepo.git
cd arepo
```

<Aside type="note" title="소스 접근 권한 오류가 날 때">
`git clone` 권한 오류가 나면 AREPO 공식 배포 채널로 소스를 먼저 받은 뒤,
압축 해제된 `arepo` 루트에서 같은 절차를 진행하시면 됩니다.
</Aside>

### 3) `wave_1d` 예제 준비

```bash
mkdir -p run/examples/wave_1d
cp -r examples/wave_1d/* run/examples/wave_1d/
python run/examples/wave_1d/create.py run/examples/wave_1d/
```

### 4) Conda 라이브러리로 컴파일

```bash
export LD_LIBRARY_PATH="$CONDA_PREFIX/lib:${LD_LIBRARY_PATH:-}"
export DYLD_FALLBACK_LIBRARY_PATH="$CONDA_PREFIX/lib:${DYLD_FALLBACK_LIBRARY_PATH:-}"

make -j"$(getconf _NPROCESSORS_ONLN 2>/dev/null || sysctl -n hw.ncpu)" \
  SYSTYPE=Conda \
  CC=mpicc LINKER=mpicc \
  MPICH_INCL="-I${CONDA_PREFIX}/include" \
  MPICH_LIB="-L${CONDA_PREFIX}/lib -lmpi" \
  GSL_INCL="-I${CONDA_PREFIX}/include" \
  GSL_LIB="-L${CONDA_PREFIX}/lib -lgsl -lgslcblas" \
  HDF5_INCL="-I${CONDA_PREFIX}/include -DH5_USE_16_API" \
  HDF5_LIB="-L${CONDA_PREFIX}/lib -lhdf5 -lz" \
  FFTW_INCL="-I${CONDA_PREFIX}/include" \
  FFTW_LIBS="-L${CONDA_PREFIX}/lib" \
  HWLOC_INCL="-I${CONDA_PREFIX}/include" \
  HWLOC_LIB="-L${CONDA_PREFIX}/lib -lhwloc" \
  CONFIG=run/examples/wave_1d/Config.sh \
  BUILD_DIR=run/examples/wave_1d/build \
  EXEC=run/examples/wave_1d/Arepo
```

### 5) 실행 + 자동 검증

```bash
(cd run/examples/wave_1d && mpiexec -np 1 ./Arepo ./param.txt)
python run/examples/wave_1d/check.py run/examples/wave_1d/ False
```

성공 기준:
- `check.py`가 정상 종료(쉘 exit code `0`)
- L1 error 출력은 나오지만 허용오차를 넘지 않음

### 6) 자주 발생하는 오류

- `CondaError: Run 'conda init' before 'conda activate'`
  - `conda init bash` 또는 `conda init zsh` 실행 후 새 터미널에서 재시도하세요.
- `fatal error: mpi.h: No such file or directory`
  - `conda activate arepo-lab` 상태인지 확인하고 `which mpicc`가 환경 경로를 가리키는지 확인하세요.
- `cannot find -lhdf5` / `cannot find -lgsl`
  - 컴파일 명령의 `HDF5_LIB`, `GSL_LIB`에 `${CONDA_PREFIX}/lib` 경로가 들어갔는지 확인하세요.
- 실행 시 `libmpi` 또는 `libhdf5` 로딩 오류
  - `LD_LIBRARY_PATH`(Linux/WSL) 또는 `DYLD_FALLBACK_LIBRARY_PATH`(macOS) export 이후 다시 실행하세요.

## 공식 참고 문서

- [AREPO User Guide: Getting started](https://arepo-code.org/wp-content/userguide/running.html)
- [AREPO User Guide: Simulation examples](https://arepo-code.org/wp-content/userguide/simtypes.html)
- [AREPO public repository (GitLab)](https://gitlab.mpcdf.mpg.de/vrs/arepo)

## 이어서 보기

- [비교표](/ko/compare/)
- [용어집](/ko/glossary/)
